# TODO: Add title, description, etc.
$schema: http://www.example.org/IG
definitions:
  LogicalOperator:
    type: string
    enum:
      - AND
      - OR
      - XOR

  # An abstract node in the IG tree        
  Node:
    type: object
    properties:
      value: { type: string }
      begin: { type: integer }
      length: { type: integer }

    # These are required for files exchanged between tools
    # For user display, these properties may be omitted if they repeat themselves in parent nodes
    # TODO: can we make this 'requiredness' depend on some switch at root level?
    required:
      - value
      - begin
      - length

  # Abstract type entailing:
  #  - RegulativeInstitutionalStatement
  #  - ConstitutiveInstitutionalStatement
  #  - InstitutionalStatementCombination
  #
  # TODO: Investigate whether we need a 'statementType' field to capture information
  #   about statements of fact.
  AbstractInstitutionalStatement:
    type: object
    allOf:
      - $ref: '#/definitions/Node'
    properties:  
      inversion: { type: boolean }
      orElse: { $ref: '#/definitions/InstitutionalStatement' }
    required:
      - inversion

  # Any type of institutional statement
  InstitutionalStatement:
    oneOf:
      - $ref: '#/definitions/RegulativeInstitutionalStatement'
      - $ref: '#/definitions/ConstitutiveInstitutionalStatement'
      - $ref: '#/definitions/InstitutionalStatementCombination'

  RegulativeInstitutionalStatement:
    allOf:
      - $ref: '#/definitions/AbstractInstitutionalStatement'
    properties:
      attribute: { $ref: '#/definitions/StatementOrNodeWithProperties' }
      directObject: { $ref: '#/definitions/StatementOrNodeWithProperties' }
      indirectObject: { $ref: '#/definitions/StatementOrNodeWithProperties' }
      deontic: { $ref: '#/definitions/Node' }
      aim: { $ref: '#/definitions/Node' }
      activationCondition: { $ref: '#/definitions/ConditionOrConstraint' }
      executionConstraint: { $ref: '#/definitions/ConditionOrConstraint' }
    required:
      - attribute
      - aim
    additionalProperties: false

  ConstitutiveInstitutionalStatement:
    allOf:
      - $ref: '#/definitions/AbstractInstitutionalStatement'
    properties:
      constitutedEntity: { $ref: '#/definitions/StatementOrNodeWithProperties' }
      deontic: { $ref: '#/definitions/Node' }
      constitutiveFunction: { $ref: '#/definitions/Node' }
      constitutingProperties: { $ref: '#/definitions/StatementOrNodeWithProperties' }
      activationCondition: { $ref: '#/definitions/ConditionOrConstraint' }
      executionConstraint: { $ref: '#/definitions/ConditionOrConstraint' }
    required:
      - constitutedEntity
      - constitutiveFunction
    additionalProperties: false
  
  # Logical combination of statements
  InstitutionalStatementCombination:
    allOf:
      - $ref: '#/definitions/AbstractInstitutionalStatement'
    properties:
      logicalOperator: { $ref: '#/definitions/LogicalOperator' }
      statements:
        type: array
        items: { $ref: '#/definitions/InstitutionalStatement' }
        minItems: 2
    additionalProperties: false

  # TODO: Confirm that only one Cac / Cex is possible within a statement
  # Type for both activation conditions and execution constraints
  ConditionOrConstraint:
    type: object
    oneOf:
#      - type: array
#        items: { $ref: '#/definitions/Node' }
#        minLength: 1
      - $ref: '#/definitions/InstitutionalStatement'
      - $ref: '#/definitions/Node'


  # TODO: it doesn't capture AND/OR/XOR horizontal nesting
  # see: page 22 of spec, () Statement

  # Can be either a nested statement or a node with attached properties. Represents:
  #   - Attribute
  #   - Object
  #   - ConstitutedEntity
  #   - Property
  StatementOrNodeWithProperties:
    type: object
    additionalProperties: false
    oneOf:
      - $ref: '#/definitions/InstitutionalStatement'
      # TODO: property 'value' has itself property 'value', that is rather ugly
      - properties:
          element: { $ref: '#/definitions/Node' }
          properties:
            type: array
            items: { $ref: '#/definitions/StatementOrNodeWithProperties' }
        required:
          - element
        
  

# Root element
type: object
properties:
  content: { type: string }
  statements:
    type: array
    items: { $ref: '#/definitions/InstitutionalStatement' }
additionalProperties: false


# %% Regulative Statement
#	%(A) Attribute
#		The State 
#	%(I) Aim
#		requires 
#	%(Bdir)
#	%%Regulative Statement
#		%(A) Attribute
#			employers 
#		%(I) Aim
#		to provide 
#		%(Bdir)
#			notification
#		%(Bdir, prop)
#			of the availability of unemployment compensation 
#		%(Bind)
#			to employees 
#		%Activation Condition
#			at the time of separation from employment.
